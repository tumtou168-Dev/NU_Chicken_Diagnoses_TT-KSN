{% extends "layouts/base.html" %}

{% block title %}Diagnosis Detail{% endblock %}
{% block page_title %}Diagnosis Report{% endblock %}
{% block page_subtitle %}Detailed view of case #{{ case.id }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="mb-3">
            <a href="{{ url_for('expert_system.cases_index') }}" class="text-decoration-none text-muted">
                <i class="bi bi-arrow-left me-1"></i> Back to History
            </a>
        </div>

        <div class="card border-0 shadow-sm overflow-hidden">
            <!-- Header Section -->
            <div class="card-header bg-white border-bottom p-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h5 class="text-uppercase text-muted small fw-bold mb-1">Diagnosis For</h5>
                        <h3 class="fw-bold text-dark mb-0">{{ case.disease.name }}</h3>
                        <span class="badge bg-primary bg-opacity-10 text-primary mt-2">{{ case.disease.category.name }}</span>
                    </div>
                    <div class="text-end">
                        <div class="text-uppercase text-muted small fw-bold mb-1">Date</div>
                        <div class="fw-semibold">{{ case.created_at.strftime('%B %d, %Y') }}</div>
                        <div class="small text-muted">{{ case.created_at.strftime('%I:%M %p') }}</div>
                    </div>
                </div>
            </div>

            <div class="card-body p-0">
                <!-- Confidence Meter -->
                <div class="bg-light p-4 border-bottom">
                    <div class="d-flex justify-content-between align-items-end mb-2">
                        <span class="fw-bold text-muted text-uppercase small">Confidence Level</span>
                        <span class="fw-bold fs-4 {% if case.confidence > 80 %}text-success{% elif case.confidence > 50 %}text-warning{% else %}text-danger{% endif %}">
                            {{ case.confidence }}%
                        </span>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar {% if case.confidence > 80 %}bg-success{% elif case.confidence > 50 %}bg-warning{% else %}bg-danger{% endif %}"
                             role="progressbar"
                             style="width: {{ case.confidence }}%"
                             aria-valuenow="{{ case.confidence }}"
                             aria-valuemin="0"
                             aria-valuemax="100"></div>
                    </div>
                </div>

                <div class="row g-0">
                    <!-- Left Column: Disease Info -->
                    <div class="col-md-7 p-4 border-end">
                        <div class="mb-4">
                            <h6 class="fw-bold text-uppercase text-muted small mb-3">
                                <i class="bi bi-info-circle me-2"></i>Description
                            </h6>
                            <p class="text-secondary">{{ case.disease.description }}</p>
                        </div>

                        <div>
                            <h6 class="fw-bold text-uppercase text-muted small mb-3">
                                <i class="bi bi-bandaid me-2"></i>Recommended Treatment
                            </h6>
                            <div class="p-3 bg-success bg-opacity-10 rounded border border-success border-opacity-10">
                                <p class="mb-0 text-dark">{{ case.disease.treatment }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Symptoms Observed -->
                    <div class="col-md-5 p-4 bg-light">
                        <h6 class="fw-bold text-uppercase text-muted small mb-3">
                            <i class="bi bi-clipboard-check me-2"></i>Observed Symptoms
                        </h6>
                        <div class="d-flex flex-column gap-2">
                            {% for symptom in case.symptoms %}
                            <div class="d-flex align-items-center bg-white p-2 rounded border shadow-sm">
                                <i class="bi bi-check-circle-fill text-primary me-2 ms-1"></i>
                                <span class="fw-medium">{{ symptom.name }}</span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="card-footer bg-white p-3 text-center border-top">
                <small class="text-muted">
                    Report generated by VetAssist Expert System â€¢ Case ID: #{{ case.id }}
                </small>
            </div>
        </div>
    </div>
</div>
{% endblock %}